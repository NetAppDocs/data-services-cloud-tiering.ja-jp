---
sidebar: sidebar 
permalink: task-tiering-onprem-azure.html 
keywords: data tiering, fabricpool, cloud tiering, tiering cold data, tiering inactive data, tiering aff, tiering fas, tiering ontap, tiering volumes, tier data, tier cold data, tier fas, tier aff, tier ontap, azure, blob, azure blob 
summary: 非アクティブなデータを Azure Blob ストレージに階層化することで、オンプレミスのONTAPクラスターの領域を解放します。 
---
= NetApp Cloud TieringでオンプレミスのONTAPクラスターから Azure Blob ストレージにデータを階層化します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
非アクティブなデータを Azure Blob ストレージに階層化することで、オンプレミスのONTAPクラスターの領域を解放します。



== クイック スタート

以下の手順に従ってすぐに開始するか、残りのセクションまでスクロールして詳細を確認してください。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["1"]Azure Blob ストレージにデータを階層化する準備
[role="quick-margin-para"]
次のものが必要です:

[role="quick-margin-list"]
* NetApp Consoleに追加したONTAP 9.4 以降を実行しているソースのオンプレミスONTAPクラスターと、Azure Blob ストレージへの HTTPS 接続。 https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["クラスターの検出方法を学ぶ"^] 。
* Azure VNet またはオンプレミスにインストールされたコンソール エージェント。
* データセンター内のONTAPクラスター、Azure ストレージ、および Cloud Tiering サービスへの送信 HTTPS 接続を有効にするエージェントのネットワーク。


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["2"]階層化を設定する
[role="quick-margin-para"]
NetApp Consoleで、オンプレミスのONTAPシステムを選択し、階層化サービスに対して *有効* を選択して、プロンプトに従ってデータを Azure Blob ストレージに階層化します。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["三つ"]ライセンスの設定
[role="quick-margin-para"]
無料トライアルが終了したら、従量課金制サブスクリプション、 ONTAP Cloud Tiering BYOL ライセンス、またはその両方の組み合わせを通じて Cloud Tiering の料金を支払います。

[role="quick-margin-list"]
* Azure Marketplaceからサブスクライブするには、 https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview["マーケットプレイスオファーにアクセス"^]をクリックし、「*購読*」を選択して、指示に従います。
* Cloud Tiering BYOLライセンスを使用して支払うには、mailto:ng-cloud-tiering@netapp.com?subject=Licensing[購入が必要な場合はお問い合わせください]に連絡し、link:https://docs.netapp.com/us-en/bluexp-digital-wallet/task-manage-data-services-licenses.html["NetApp Consoleに追加する"] 。




== 要件

ONTAPクラスターのサポートを確認し、ネットワークをセットアップし、オブジェクト ストレージを準備します。

次の図は、各コンポーネントとそれらの間で準備する必要がある接続を示しています。

image:diagram_cloud_tiering_azure.png["クラウド プロバイダーのコンソール エージェントに接続された Cloud Tiering サービス、 ONTAPクラスターに接続されたエージェント、およびクラウド プロバイダーのONTAPクラスターとオブジェクト ストレージ間の接続を示すアーキテクチャ イメージ。アクティブ データはONTAPクラスター上に存在し、非アクティブ データはオブジェクト ストレージ上に存在します。"]


NOTE: コンソール エージェントと Blob ストレージ間の通信は、オブジェクト ストレージのセットアップのみに使用されます。エージェントはクラウドではなくオンプレミスに配置できます。



=== ONTAPクラスタを準備する

Azure Blob ストレージにデータを階層化する場合、 ONTAPクラスターは次の要件を満たしている必要があります。

サポートされているONTAPプラットフォーム::
+
--
* ONTAP 9.8 以降を使用する場合: AFFシステム、またはすべて SSD のアグリゲートまたはすべて HDD のアグリゲートを持つFASシステムからデータを階層化できます。
* ONTAP 9.7 以前を使用する場合: AFFシステム、またはすべて SSD アグリゲートを持つFASシステムからデータを階層化できます。


--
サポートされるONTAPのバージョン:: ONTAP 9.4 以降
クラスターネットワークの要件::
+
--
* ONTAPクラスターは、ポート 443 経由で Azure Blob ストレージへの HTTPS 接続を開始します。
+
ONTAP はオブジェクト ストレージとの間でデータの読み取りと書き込みを行います。オブジェクト ストレージは開始することはなく、応答するだけです。

+
ExpressRoute はパフォーマンスが向上し、データ転送料金が低くなりますが、 ONTAPクラスターと Azure Blob ストレージ間では必要ありません。しかし、そうすることが推奨されるベストプラクティスです。

* エージェントからの受信接続が必要です。エージェントは、Azure VNet またはオンプレミスに配置できます。
+
クラスターと Cloud Tiering サービス間の接続は必要ありません。

* 階層化するボリュームをホストする各ONTAPノードには、クラスタ間 LIF が必要です。  LIF は、 ONTAP がオブジェクト ストレージに接続するために使用する _IPspace_ に関連付ける必要があります。
+
データ階層化を設定すると、Cloud Tiering によって使用する IPspace の入力が求められます。各 LIF が関連付けられている IPspace を選択する必要があります。これは、「デフォルト」の IPspace の場合もあれば、作成したカスタム IPspace の場合もあります。詳細はこちら https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["LIF"^]そして https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IPspace"^]。



--
サポートされているボリュームとアグリゲート:: Cloud Tiering で階層化できるボリュームの合計数は、 ONTAPシステム上のボリューム数よりも少なくなる可能性があります。これは、一部のアグリゲートからボリュームを階層化できないためです。  ONTAPのドキュメントを参照してください。 https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html#functionality-or-features-not-supported-by-fabricpool["FabricPoolでサポートされていない機能"^] 。



NOTE: Cloud Tiering は、 ONTAP 9.5 以降、 FlexGroupボリュームをサポートします。セットアップは他のボリュームと同じように機能します。



=== ONTAPクラスタの検出

コールド データの階層化を開始する前に、オンプレミスのONTAPシステムをNetApp Consoleに追加する必要があります。

https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["クラスターの検出方法を学ぶ"^]。



=== エージェントを作成または切り替える

データをクラウドに階層化するにはエージェントが必要です。 Azure Blob ストレージにデータを階層化する場合は、Azure VNet 内またはオンプレミスにあるエージェントを使用できます。新しいエージェントを作成するか、現在選択されているエージェントが Azure またはオンプレミスに存在することを確認する必要があります。

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["エージェントについて学ぶ"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-azure.html["Azure にエージェントを展開する"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-on-prem.html["Linuxホストへのエージェントのインストール"^]




=== 必要なエージェント権限があることを確認してください

バージョン 3.9.25 以降を使用してコンソール エージェントを作成した場合、設定は完了です。エージェントが Azure ネットワーク内のリソースとプロセスを管理するために必要なアクセス許可を提供するカスタム ロールが既定で設定されます。参照 https://docs.netapp.com/us-en/console-setup-admin/reference-permissions-azure.html["必要なカスタムロール権限"^]そして https://docs.netapp.com/us-en/console-setup-admin/reference-permissions-azure.html#tiering["クラウド階層化に必要な特定の権限"^]。

以前のバージョンを使用してエージェントを作成した場合は、Azure アカウントのアクセス許可リストを編集して、不足しているアクセス許可を追加する必要があります。



=== コンソールエージェントのネットワークを準備する

コンソール エージェントに必要なネットワーク接続があることを確認します。エージェントはオンプレミスまたは Azure にインストールできます。

.手順
. エージェントがインストールされているネットワークで次の接続が有効になっていることを確認します。
+
** ポート443経由のクラウド階層化サービスとAzure BlobオブジェクトストレージへのHTTPS接続(https://docs.netapp.com/us-en/bluexp-setup-admin/task-set-up-networking-azure.html#endpoints-contacted-for-day-to-day-operations["エンドポイントのリストを見る"^]）
** ポート443経由のONTAPクラスタ管理LIFへのHTTPS接続


. 必要に応じて、Azure ストレージへの VNet サービス エンドポイントを有効にします。
+
ONTAPクラスターから VNet への ExpressRoute または VPN 接続があり、エージェントと Blob ストレージ間の通信を仮想プライベート ネットワーク内に維持したい場合は、Azure ストレージへの VNet サービス エンドポイントが推奨されます。





=== Azure Blobストレージを準備する

階層化を設定するときは、使用するリソース グループと、そのリソース グループに属するストレージ アカウントおよび Azure コンテナーを特定する必要があります。ストレージ アカウントにより、Cloud Tiering はデータ階層化に使用される BLOB コンテナーを認証してアクセスできるようになります。

Cloud Tiering は、エージェント経由でアクセスできる任意のリージョンの任意のストレージ アカウントへの階層化をサポートします。

Cloud Tiering では、General Purpose v2 および Premium Block Blob タイプのストレージ アカウントのみがサポートされます。


NOTE: 一定の日数後に階層化されたデータが移行される低コストのアクセス層を使用するようにクラウド階層化を構成する予定の場合は、Azure アカウントでコンテナーを設定するときにライフサイクル ルールを選択しないでください。  Cloud Tiering はライフサイクルの遷移を管理します。



== 最初のクラスターから非アクティブなデータを Azure Blob ストレージに階層化する

Azure 環境を準備したら、最初のクラスターから非アクティブなデータの階層化を開始します。

.要件
https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["オンプレミスのONTAPシステムからNetApp Consoleへ"^]。

.手順
. オンプレミスのONTAPシステムを選択します。
. 右側のパネルから、階層化サービスの「*有効*」をクリックします。
+
Azure BLOB 階層化先がシステムとして [システム] ページに存在する場合は、クラスターを Azure BLOB システムにドラッグしてセットアップ ウィザードを開始できます。

+
image:screenshot_setup_tiering_onprem.png["オンプレミスのONTAPシステムを選択した後、画面の右側に表示される [有効化] オプションを示すスクリーンショット。"]

. *オブジェクト ストレージ名の定義*: このオブジェクト ストレージの名前を入力します。このクラスター上のアグリゲートで使用している他のオブジェクト ストレージとは一意である必要があります。
. *プロバイダーの選択*: *Microsoft Azure* を選択し、*続行* を選択します。
. *オブジェクト ストレージの作成* ページの手順を完了します。
+
.. *リソース グループ*: 既存のコンテナーが管理されているリソース グループ、または階層化データ用の新しいコンテナーを作成するリソース グループを選択し、[続行] を選択します。
+
オンプレミス エージェントを使用する場合は、リソース グループへのアクセスを提供する Azure サブスクリプションを入力する必要があります。

.. *Azure コンテナー*: ラジオ ボタンを選択して、新しい BLOB コンテナーをストレージ アカウントに追加するか、既存のコンテナーを使用します。次に、ストレージ アカウントを選択し、既存のコンテナーを選択するか、新しいコンテナーの名前を入力します。次に、[続行] を選択します。
+
この手順で表示されるストレージ アカウントとコンテナーは、前の手順で選択したリソース グループに属します。

.. *アクセス層のライフサイクル*: クラウド階層化は、階層化されたデータのライフサイクルの遷移を管理します。データは _Hot_ クラスから始まりますが、一定の日数経過後にデータに _Cool_ クラスを適用するルールを作成できます。
+
階層化されたデータを移行するアクセス ティアと、そのティアにデータが割り当てられるまでの日数を選択し、[続行] を選択します。たとえば、以下のスクリーンショットは、オブジェクト ストレージで 45 日経過後に階層化データが _Hot_ クラスから _Cool_ クラスに割り当てられていることを示しています。

+
*このアクセス層にデータを保持する*を選択した場合、データは_ホット_アクセス層に残り、ルールは適用されません。link:reference-azure-support.html["サポートされているアクセス層を確認する"^] 。

+
image:screenshot_tiering_lifecycle_selection_azure.png["一定の日数後にデータに割り当てられる別のアクセス ティアを選択する方法を示したスクリーンショット。"]

+
ライフサイクル ルールは、選択したストレージ アカウント内のすべての BLOB コンテナーに適用されることに注意してください。

.. *クラスタ ネットワーク*: ONTAP がオブジェクト ストレージに接続するために使用する IPspace を選択し、*続行* を選択します。
+
正しい IPspace を選択すると、Cloud Tiering がONTAPからクラウド プロバイダーのオブジェクト ストレージへの接続を確立できるようになります。

+
「最大転送速度」を定義することで、非アクティブなデータをオブジェクト ストレージにアップロードするために使用できるネットワーク帯域幅を設定することもできます。  *制限*ラジオ ボタンを選択し、使用できる最大帯域幅を入力するか、*無制限*を選択して制限がないことを示します。



. [_Tier Volumes_] ページで、階層化を構成するボリュームを選択し、[Tiering Policy] ページを起動します。
+
** すべてのボリュームを選択するには、タイトル行のボックスをチェックします（image:button_backup_all_volumes.png[""] ）をクリックし、「ボリュームの構成」を選択します。
** 複数のボリュームを選択するには、各ボリュームのボックスをチェックします（image:button_backup_1_volume.png[""] ）をクリックし、「ボリュームの構成」を選択します。
** 単一のボリュームを選択するには、行（またはimage:screenshot_edit_icon.gif["鉛筆アイコンを編集"]ボリュームの（アイコン）をクリックします。
+
image:screenshot_tiering_initial_volumes.png["単一のボリューム、複数のボリューム、またはすべてのボリュームを選択する方法と、選択したボリュームを変更するボタンを示すスクリーンショット。"]



. [_階層化ポリシー_] ダイアログで、階層化ポリシーを選択し、必要に応じて選択したボリュームの冷却日数を調整して、[適用] を選択します。
+
link:concept-cloud-tiering.html#volume-tiering-policies["ボリューム階層化ポリシーと冷却日の詳細"]。

+
image:screenshot_tiering_initial_policy_settings.png["構成可能な階層化ポリシー設定を示すスクリーンショット。"]



.結果
クラスター上のボリュームから Azure Blob オブジェクト ストレージへのデータ階層化が正常に設定されました。

.次の手順
link:task-licensing-cloud-tiering.html["クラウド階層化サービスに必ず加入してください"]。

クラスター上のアクティブなデータと非アクティブなデータに関する情報を確認できます。link:task-managing-tiering.html["階層設定の管理について詳しくは"] 。

クラスター上の特定のアグリゲートから異なるオブジェクト ストアにデータを階層化する必要がある場合は、追加のオブジェクト ストレージを作成することもできます。または、階層化されたデータが追加のオブジェクト ストアに複製されるFabricPoolミラーリングを使用する予定の場合。link:task-managing-object-storage.html["オブジェクトストアの管理について詳しくは"] 。
