---
sidebar: sidebar 
permalink: task-tiering-onprem-gcp.html 
keywords: data tiering, fabricpool, cloud tiering, tiering cold data, tiering inactive data, tiering aff, tiering fas, tiering ontap, tiering volumes, tier data, tier cold data, tier fas, tier aff, tier ontap, google, gcp, google cloud storage 
summary: NetApp Cloud Tiering で非アクティブなデータを Google Cloud Storage に階層化することで、オンプレミスのONTAPクラスタの空き容量を増やすことができます。 
---
= NetApp Cloud Tiering でオンプレミスのONTAPクラスタから Google Cloud Storage にデータを階層化
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
NetApp Cloud Tiering で非アクティブなデータを Google Cloud Storage に階層化することで、オンプレミスのONTAPクラスタの空き容量を増やします。



== クイック スタート

以下の手順に従ってすぐに開始するか、残りのセクションまでスクロールして詳細を確認してください。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["1"]Google Cloud Storage にデータを階層化する準備
[role="quick-margin-para"]
次のものが必要です:

[role="quick-margin-list"]
* NetAppコンソールに追加したONTAP 9.6 以降を実行しているソースのオンプレミスONTAPクラスタと、ユーザー指定のポート経由での Google Cloud Storage への接続。 https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["クラスターの検出方法を学ぶ"^] 。
* 事前定義されたストレージ管理者ロールとストレージ アクセス キーを持つサービス アカウント。
* Google Cloud Platform VPC にインストールされたコンソール エージェント。
* データセンター内のONTAPクラスタ、Google Cloud Storage、および Cloud Tiering サービスへの送信 HTTPS 接続を有効にするエージェントのネットワーク。


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["2"]階層化を設定する
[role="quick-margin-para"]
NetAppコンソールで、オンプレミス システムを選択し、階層化サービスに対して [*有効*] を選択して、プロンプトに従ってデータを Google Cloud Storage に階層化します。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["三つ"]ライセンスの設定
[role="quick-margin-para"]
無料トライアルが終了したら、従量課金制サブスクリプション、 ONTAP Cloud Tiering BYOL ライセンス、またはその両方の組み合わせを通じて Cloud Tiering の料金を支払います。

[role="quick-margin-list"]
* Google Cloud Marketplaceから登録するには、 https://console.cloud.google.com/marketplace/details/netapp-cloudmanager/cloud-manager?supportedpurview=project&rif_reserved["マーケットプレイスオファーにアクセス"^]をクリックし、「*購読*」を選択して、指示に従います。
* Cloud Tiering BYOLライセンスを使用して支払うには、mailto:ng-cloud-tiering@netapp.com?subject=Licensing[購入が必要な場合はお問い合わせください]に連絡し、link:https://docs.netapp.com/us-en/bluexp-digital-wallet/task-manage-data-services-licenses.html["NetAppコンソールに追加する"^] 。




== 要件

ONTAPクラスターのサポートを確認し、ネットワークをセットアップし、オブジェクト ストレージを準備します。

次の図は、各コンポーネントとそれらの間で準備する必要がある接続を示しています。

image:diagram_cloud_tiering_google.png["クラウド プロバイダーのエージェントに接続された Cloud Tiering サービス、 ONTAPクラスターに接続されたエージェント、およびクラウド プロバイダーのONTAPクラスターとオブジェクト ストレージ間の接続を示すアーキテクチャ イメージ。アクティブ データはONTAPクラスター上に存在し、非アクティブ データはオブジェクト ストレージ上に存在します。"]


NOTE: エージェントと Google Cloud Storage 間の通信は、オブジェクト ストレージのセットアップのみに使用されます。



=== ONTAPクラスタを準備する

Google Cloud Storage にデータを階層化する場合、 ONTAPクラスターは次の要件を満たしている必要があります。

サポートされているONTAPプラットフォーム::
+
--
* ONTAP 9.8 以降を使用する場合: AFFシステム、またはすべて SSD のアグリゲートまたはすべて HDD のアグリゲートを持つFASシステムからデータを階層化できます。
* ONTAP 9.7 以前を使用する場合: AFFシステム、またはすべて SSD アグリゲートを持つFASシステムからデータを階層化できます。


--
サポートされるONTAPバージョン:: ONTAP 9.6 以降
クラスターネットワークの要件::
+
--
* ONTAPクラスタは、ポート 443 経由で Google Cloud Storage への HTTPS 接続を開始します。
+
ONTAP はオブジェクト ストレージとの間でデータの読み取りと書き込みを行います。オブジェクト ストレージは開始することはなく、応答するだけです。

+
Google Cloud Interconnect を使用するとパフォーマンスが向上し、データ転送料金が削減されますが、 ONTAPクラスタと Google Cloud Storage の間では必須ではありません。しかし、そうすることが推奨されるベストプラクティスです。

* Google Cloud Platform VPC にあるエージェントからの受信接続が必要です。
+
クラスターと Cloud Tiering サービス間の接続は必要ありません。

* 階層化するボリュームをホストする各ONTAPノードには、クラスタ間 LIF が必要です。  LIF は、 ONTAP がオブジェクト ストレージに接続するために使用する _IPspace_ に関連付ける必要があります。
+
データ階層化を設定すると、Cloud Tiering によって使用する IPspace の入力が求められます。各 LIF が関連付けられている IPspace を選択する必要があります。これは、「デフォルト」の IPspace の場合もあれば、作成したカスタム IPspace の場合もあります。詳細はこちら https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["LIF"^]そして https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IPspace"^]。



--
サポートされているボリュームとアグリゲート:: Cloud Tiering で階層化できるボリュームの合計数は、 ONTAPシステム上のボリューム数よりも少なくなる可能性があります。これは、一部のアグリゲートからボリュームを階層化できないためです。  ONTAPのドキュメントを参照してください。 https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html#functionality-or-features-not-supported-by-fabricpool["FabricPoolでサポートされていない機能"^] 。



NOTE: Cloud Tiering はFlexGroupボリュームをサポートします。セットアップは他のボリュームと同じように機能します。



=== ONTAPクラスタの検出

コールド データの階層化を開始する前に、オンプレミスのONTAPシステムをNetAppコンソールに追加する必要があります。

https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["クラスターの検出方法を学ぶ"^] 。



=== コンソールエージェントの作成または切り替え

データをクラウドに階層化するには、コンソール エージェントが必要です。 Google Cloud Storage にデータを階層化する場合、Google Cloud Platform VPC でエージェントが利用可能である必要があります。新しいエージェントを作成するか、現在選択されているエージェントが Google Cloud に存在することを確認する必要があります。

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["エージェントについて学ぶ"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-google.html["Google Cloud にエージェントをデプロイする"^]




=== コンソールエージェントのネットワークを準備する

コンソール エージェントに必要なネットワーク接続があることを確認します。

.手順
. エージェントがインストールされている VPC で次の接続が有効になっていることを確認します。
+
** ポート443経由のCloud TieringサービスとGoogle Cloud StorageへのHTTPS接続(https://docs.netapp.com/us-en/bluexp-setup-admin/task-set-up-networking-google.html#endpoints-contacted-for-day-to-day-operations["エンドポイントのリストを見る"^]）
** ポート443経由のONTAPクラスタ管理LIFへのHTTPS接続


. オプション: エージェントをデプロイする予定のサブネットでプライベート Google アクセスを有効にします。
+
https://cloud.google.com/vpc/docs/configure-private-google-access["プライベートGoogleアクセス"^]ONTAPクラスタから VPC への直接接続があり、エージェントと Google Cloud Storage 間の通信を仮想プライベート ネットワーク内に維持したい場合は、これが推奨されます。プライベート Google アクセスは、内部（プライベート） IP アドレスのみ（外部 IP アドレスなし）を持つ VM インスタンスで機能することに注意してください。





=== Google Cloud Storageを準備する

階層化を設定するときは、ストレージ管理者権限を持つサービス アカウントのストレージ アクセス キーを提供する必要があります。サービス アカウントを使用すると、Cloud Tiering はデータ階層化に使用される Cloud Storage バケットを認証してアクセスできるようになります。  Google Cloud Storage が誰がリクエストを行っているかを認識するために、キーが必要になります。

Cloud Storageバケットは、link:reference-google-support.html#supported-google-cloud-regions["クラウド階層化をサポートするリージョン"] 。


NOTE: 一定の日数後に階層化されたデータが移行される低コストのストレージ クラスを使用するように Cloud Tiering を構成する予定の場合は、GCP アカウントでバケットを設定するときにライフサイクル ルールを選択しないでください。  Cloud Tiering はライフサイクルの遷移を管理します。

.手順
. https://cloud.google.com/iam/docs/creating-managing-service-accounts#creating_a_service_account["定義済みのストレージ管理者ロールを持つサービス アカウントを作成します"^] 。
. へ移動 https://console.cloud.google.com/storage/settings["GCP ストレージ設定"^]サービス アカウントのアクセス キーを作成します。
+
.. プロジェクトを選択し、*相互運用性*を選択します。まだ行っていない場合は、[相互運用性アクセスを有効にする] を選択します。
.. プロジェクトを選択し、*相互運用性*を選択します。まだ行っていない場合は、[相互運用性アクセスを有効にする] を選択します。
.. *サービス アカウントのアクセス キー* の下で、*サービス アカウントのキーの作成* を選択し、作成したサービス アカウントを選択して、*キーの作成* を選択します。
.. *サービス アカウントのアクセス キー* の下で、*サービス アカウントのキーの作成* を選択し、作成したサービス アカウントを選択して、*キーの作成* を選択します。
+
後で Cloud Tiering を設定するときに、キーを入力する必要があります。







== 最初のクラスタから非アクティブなデータを Google Cloud Storage に階層化します

Google Cloud 環境を準備したら、最初のクラスタから非アクティブなデータの階層化を開始します。

.要件
* https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["NetAppコンソールに追加されたオンプレミスシステム"^] 。
* ストレージ管理者のロールを持つサービス アカウントのストレージ アクセス キー。


.手順
. オンプレミスのONTAPシステムを選択します。
. 右側のパネルから、階層化サービスの「*有効*」をクリックします。
+
Google Cloud Storage の階層化先が *システム* ページで使用できる場合は、クラスタを Google Cloud Storage システムにドラッグしてセットアップ ウィザードを開始できます。

+
image:screenshot_setup_tiering_onprem.png["オンプレミスのONTAPシステムを選択した後、画面の右側に表示される [有効化] オプションを示すスクリーンショット。"]

. *オブジェクト ストレージ名の定義*: このオブジェクト ストレージの名前を入力します。このクラスター上のアグリゲートで使用している他のオブジェクト ストレージとは一意である必要があります。
. *プロバイダを選択*: *Google Cloud* を選択し、*続行* を選択します。
. *オブジェクト ストレージの作成* ページの手順を完了します。
+
.. *バケット*: 新しい Google Cloud Storage バケットを追加するか、既存のバケットを選択します。
.. *ストレージ クラスのライフサイクル*: クラウド階層化は、階層化されたデータのライフサイクルの遷移を管理します。データは _Standard_ クラスで始まりますが、一定の日数が経過すると異なるストレージ クラスを適用するルールを作成できます。
+
階層化されたデータを移行する Google Cloud ストレージ クラスと、そのクラスにデータが割り当てられるまでの日数を選択し、[続行] を選択します。たとえば、以下のスクリーンショットは、階層化データがオブジェクト ストレージで 30 日経過すると _Standard_ クラスから _Nearline_ クラスに割り当てられ、オブジェクト ストレージで 60 日経過すると _Coldline_ クラスに割り当てられることを示しています。

+
*このストレージ クラスにデータを保持する* を選択した場合、データはそのストレージ クラスに残ります。link:reference-google-support.html["サポートされているストレージクラスを参照"^] 。

+
image:screenshot_tiering_lifecycle_selection_gcp.png["一定の日数後にデータに割り当てられる追加のストレージ クラスを選択する方法を示したスクリーンショット。"]

+
ライフサイクル ルールは、選択したバケット内のすべてのオブジェクトに適用されることに注意してください。

.. *資格情報*: ストレージ管理者のロールを持つサービス アカウントのストレージ アクセス キーとシークレット キーを入力します。
.. *クラスタ ネットワーク*: ONTAP がオブジェクト ストレージに接続するために使用する IPspace を選択します。
+
正しい IPspace を選択すると、Cloud Tiering がONTAPからクラウド プロバイダーのオブジェクト ストレージへの接続を確立できるようになります。

+
「最大転送速度」を定義することで、非アクティブなデータをオブジェクト ストレージにアップロードするために使用できるネットワーク帯域幅を設定することもできます。  *制限*ラジオ ボタンを選択し、使用できる最大帯域幅を入力するか、*無制限*を選択して制限がないことを示します。



. *続行*をクリックして、階層化するボリュームを選択します。
. [_Tier Volumes_] ページで、階層化を構成するボリュームを選択し、[Tiering Policy] ページを起動します。
+
** すべてのボリュームを選択するには、タイトル行のボックスをチェックします（image:button_backup_all_volumes.png[""] ）をクリックし、「ボリュームの構成」を選択します。
** 複数のボリュームを選択するには、各ボリュームのボックスをチェックします（image:button_backup_1_volume.png[""] ）をクリックし、「ボリュームの構成」を選択します。
** 単一のボリュームを選択するには、行（またはimage:screenshot_edit_icon.gif["鉛筆アイコンを編集"]ボリュームの（アイコン）をクリックします。
+
image:screenshot_tiering_initial_volumes.png["単一のボリューム、複数のボリューム、またはすべてのボリュームを選択する方法と、選択したボリュームを変更するボタンを示すスクリーンショット。"]



. [_階層化ポリシー_] ダイアログで、階層化ポリシーを選択し、必要に応じて選択したボリュームの冷却日数を調整して、[適用] を選択します。
+
link:concept-cloud-tiering.html#volume-tiering-policies["ボリューム階層化ポリシーと冷却日の詳細"] 。

+
image:screenshot_tiering_initial_policy_settings.png["構成可能な階層化ポリシー設定を示すスクリーンショット。"]



.結果
クラスタ上のボリュームから Google Cloud オブジェクト ストレージへのデータ階層化が正常に設定されました。

.次の手順
link:task-licensing-cloud-tiering.html["クラウド階層化サービスに必ず加入してください"] 。

クラスター上のアクティブなデータと非アクティブなデータに関する情報を確認できます。link:task-managing-tiering.html["階層設定の管理について詳しくは"] 。

クラスター上の特定のアグリゲートから異なるオブジェクト ストアにデータを階層化する必要がある場合は、追加のオブジェクト ストレージを作成することもできます。または、階層化されたデータが追加のオブジェクト ストアに複製されるFabricPoolミラーリングを使用する予定の場合。link:task-managing-object-storage.html["オブジェクトストアの管理について詳しくは"] 。
