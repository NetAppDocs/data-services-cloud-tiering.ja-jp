---
sidebar: sidebar 
permalink: concept-cloud-tiering.html 
keywords: cloud tiering, overview, conceptual, value, features, cost, charging, tiering policies, cooling period, fabricpool, netapp console, console, bluexp 
summary: NetApp のクラウド階層化サービスは、オンプレミスのONTAPクラスターからオブジェクト ストレージに非アクティブなデータを自動的に階層化することで、データセンターをクラウドに拡張します。これにより、アプリケーション層に変更を加えずに、クラスター上の貴重なスペースをより多くのワークロードに使用できるようになります。クラウド階層化により、データセンターのコストが削減され、CAPEX モデルから OPEX モデルに切り替えることができます。 
---
= NetAppクラウド階層化について学ぶ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
NetApp Cloud Tiering は、オンプレミスのONTAPクラスターからオブジェクト ストレージに非アクティブなデータを自動的に階層化することで、データセンターをクラウドに拡張します。これにより、アプリケーション層に変更を加えずに、クラスター上の貴重なスペースをより多くのワークロードに使用できるようになります。クラウド階層化により、データセンターのコストが削減され、CAPEX モデルから OPEX モデルに切り替えることができます。

Cloud Tiering は _FabricPool_ の機能を活用します。 FabricPoolは、低コストのオブジェクト ストレージへのデータの自動階層化を可能にするNetAppデータ ファブリック テクノロジーです。アクティブ (ホット) データはローカル層 (オンプレミスのONTAPアグリゲート) に残り、非アクティブ (コールド) データはクラウド層に移動されます。その間もONTAPデータの効率は維持されます。

もともとオール SSD アグリゲートを備えたAFF、 FAS、およびONTAP Selectシステムでサポートされていましたが、 ONTAP 9.8 以降では、高性能 SSD に加えて HDD で構成されるアグリゲートからのデータを階層化できます。見る https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html["FabricPoolの使用に関する考慮事項と要件"^]詳細については。

FabricPool Mirror を使用して、単一ノード クラスタ、HA 構成のクラスタ、階層化ミラー構成のクラスタ、およびMetroCluster構成のクラスタの階層化を構成できます。  Cloud Tiering ライセンスはすべてのクラスター間で共有されます。

https://bluexp.netapp.com/cloud-tiering-service-tco["クラウド階層化TCO計算ツールを使って、どれだけのコストを節約できるか確認しましょう"^] 。



== NetAppコンソール

NetApp Cloud Tiering は、 NetAppコンソールからアクセスできます。

NetAppコンソールは、オンプレミスおよびクラウド環境全体にわたるエンタープライズ規模のNetAppストレージおよびデータ サービスの集中管理を提供します。NetAppデータ サービスにアクセスして使用するには、コンソールが必要です。管理インターフェースとして、1 つのインターフェースから多数のストレージ リソースを管理できます。コンソール管理者は、企業内のすべてのシステムのストレージとサービスへのアクセスを制御できます。

NetAppコンソールの使用を開始するためにライセンスやサブスクリプションは必要ありません。ストレージ システムまたはNetAppデータ サービスへの接続を確保するためにクラウドにコンソール エージェントを展開する必要がある場合にのみ料金が発生します。ただし、コンソールからアクセスできる一部のNetAppデータ サービスは、ライセンスまたはサブスクリプションベースです。

詳細はこちら https://docs.netapp.com/us-en/bluexp-setup-admin/concept-overview.html["NetAppコンソール"]。



== 機能

Cloud Tiering は、自動化、監視、レポート、共通の管理インターフェースを提供します。

* 自動化により、オンプレミスのONTAPクラスターからクラウドへのデータ階層化の設定と管理が容易になります。
* デフォルトのクラウド プロバイダーのストレージ クラス/アクセス層を選択することも、ライフサイクル管理を使用して、よりコスト効率の高い層を古い階層化されたデータに割り当てることもできます。
* クラスター内の他の集約に使用できる追加のオブジェクト ストアへの接続を作成できます。
* UI を使用すると、オブジェクト ストアをアグリゲートにドラッグして階層化やFabricPoolミラーリングを行うことができます。
* 単一の管理画面により、複数のクラスターにわたってFabricPool を個別に管理する必要がなくなります。
* レポートには、各クラスター上のアクティブ データと非アクティブ データの量が表示されます。
* 階層化されたヘルス ステータスは、問題が発生したときにそれを特定して修正するのに役立ちます。
* Cloud Volumes ONTAPシステムをお持ちの場合は、クラスター ページでそれらを見つけることができるため、ハイブリッド クラウド インフラストラクチャのデータ階層化を完全に把握できます。


クラウド階層化が提供する価値の詳細については、 https://bluexp.netapp.com/cloud-tiering["NetAppコンソールのWebサイトのクラウド階層化ページをご覧ください"^] 。


TIP: Cloud Volumes ONTAPシステムは、Cloud Tiering からは読み取り専用です。 https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-tiering.html["Cloud Volumes ONTAPシステムの階層化は、 NetAppコンソールで設定します。"^] 。



== サポートされているオブジェクトストレージプロバイダー

オンプレミスのONTAPシステムから非アクティブなデータを次のオブジェクト ストレージ プロバイダーに階層化できます。

* Amazon S3
* Microsoft Azure ブロブ
* Google Cloud Storage
* NetAppStorageGRID
* S3互換オブジェクトストレージ（例：MinIO）


Cloud Tiering ライセンスは、IBM Cloud Object Storage にデータを階層化しているクラスターと共有することもできます。  FabricPool構成はSystem ManagerまたはONTAP CLIを使用して設定する必要がありますが、link:task-licensing-cloud-tiering.html#apply-bluexp-tiering-licenses-to-clusters-in-special-configurations["このタイプの構成のライセンスは、Cloud Tiering を使用して完了します。"]


NOTE: NAS ボリュームからパブリック クラウドまたはStorageGRIDなどのプライベート クラウドにデータを階層化できます。  SAN プロトコルでアクセスされるデータを階層化する場合、接続性を考慮して、 NetAppプライベート クラウドの使用を推奨しています。



=== オブジェクトストレージ層

ONTAPクラスタは、非アクティブなデータを単一のオブジェクト ストアまたは複数のオブジェクト ストアに階層化できます。データ階層化を設定する際には、新しいバケット/コンテナを追加するか、ストレージ クラスまたはアクセス階層とともに既存のバケット/コンテナを選択するかを選択できます。

* link:reference-aws-support.html["サポートされているAWS S3ストレージクラスについて学ぶ"]
* link:reference-azure-support.html["サポートされている Azure BLOB アクセス層について学ぶ"]
* link:reference-google-support.html["サポートされている Google Cloud ストレージ クラスについて学ぶ"]


クラウド階層化では、非アクティブなデータに対してクラウド プロバイダーのデフォルトのストレージ クラス/アクセス層が使用されます。ただし、一定の日数が経過するとデータがデフォルトのストレージ クラスから別のストレージ クラスに自動的に移行するようにライフサイクル ルールを適用できます。これにより、非常にコールドなデータをより安価なストレージに移動することで、コストを抑えることができます。


NOTE: StorageGRIDまたは S3 互換ストレージに階層化されたデータのライフサイクル ルールを選択することはできません。



== 価格とライセンス

Cloud Tiering の料金は、従量課金制サブスクリプション、年間サブスクリプション、 NetApp階層化ライセンスの持ち込み、またはこれらの組み合わせでお支払いいただけます。ライセンスをお持ちでない場合は、最初のクラスターを 30 日間無料で試用できます。

StorageGRIDにデータを階層化する場合、料金は発生しません。  BYOL ライセンスも PAYGO 登録も必要ありません。

https://bluexp.netapp.com/pricing#tiering["価格の詳細を見る"^] 。

クラウド階層化ではソース ボリュームのストレージ効率が維持されるため、 ONTAP効率化後の階層化データ (重複排除と圧縮が適用された後の少量のデータ) に対してクラウド プロバイダーのオブジェクト ストレージ コストを支払います。



=== 30日間無料トライアル

Cloud Tiering ライセンスをお持ちでない場合は、最初のクラスターに階層化を設定すると、階層化の 30 日間の無料トライアルが開始されます。  30 日間の無料トライアルが終了した後は、従量課金制サブスクリプション、年間サブスクリプション、BYOL ライセンス、またはこれらの組み合わせを通じて階層化の料金を支払う必要があります。

無料トライアルが終了し、ライセンスをサブスクライブまたは追加していない場合、 ONTAP はコールド データをオブジェクト ストレージに階層化できなくなります。以前に階​​層化されたデータはすべて引き続きアクセス可能であり、このデータを取得して使用できます。取得されると、このデータはクラウドからパフォーマンス層に戻されます。



=== 従量課金制サブスクリプション

Cloud Tiering は、従量課金モデルで消費ベースのライセンスを提供します。クラウド プロバイダーのマーケットプレイスを通じてサブスクライブすると、階層化されたデータに対して GB ごとに料金を支払います。前払いはありません。料金は、毎月の請求書を通じてクラウド プロバイダーから請求されます。

無料トライアルがある場合や、独自のライセンス (BYOL) を使用する場合でも、サブスクライブする必要があります。

* サブスクリプションに登録すると、無料トライアル期間終了後もサービスが中断されることがなくなります。
+
試用期間が終了すると、階層化したデータ量に応じて時間ごとに料金が請求されます。

* BYOL ライセンスで許可されているよりも多くのデータを階層化した場合、データ階層化は従量課金制サブスクリプションを通じて継続されます。
+
たとえば、10 TB のライセンスをお持ちの場合、10 TB を超えるすべての容量は従量課金制サブスクリプションを通じて課金されます。



無料トライアル期間中、または Cloud Tiering BYOL ライセンスを超過していない場合は、従量課金制サブスクリプションから料金は請求されません。

link:task-licensing-cloud-tiering.html#use-a-bluexp-tiering-paygo-subscription["従量課金制サブスクリプションの設定方法を学ぶ"] 。



=== 年間契約

Cloud Tiering では、非アクティブなデータを Amazon S3 または Azure に階層化する場合、年間契約を提供します。期間は 1 年、2 年、または 3 年からお選びいただけます。

Google CLoud への階層化では、現在年間契約はサポートされていません。



=== 自分のライセンスを持参する

NetAppから *Cloud Tiering* ライセンス (以前は「Cloud Tiering」ライセンスと呼ばれていました) を購入して、独自のライセンスを持ち込みます。  1 年、2 年、または 3 年の期間ライセンスを購入して、任意の階層化容量を指定できます (最小 10 TiB から)。  BYOL Cloud Tiering ライセンスは、複数のオンプレミスONTAPクラスターで使用できるフローティング ライセンスです。  Cloud Tiering ライセンスで定義した階層化容量の合計は、すべてのオンプレミス クラスターで使用できます。

Cloud Tiering ライセンスを購入したら、そのライセンスをNetAppコンソールに追加する必要があります。link:task-licensing-cloud-tiering.html#use-a-bluexp-tiering-byol-license["Cloud Tiering BYOLライセンスの使用方法をご覧ください"] 。

前述のとおり、BYOL ライセンスを購入した場合でも、従量課金制のサブスクリプションを設定することをお勧めします。


NOTE: 2021 年 8 月から、古い * FabricPool* ライセンスは * Cloud Tiering * ライセンスに置き換えられました。link:task-licensing-cloud-tiering.html#bluexp-tiering-byol-licensing-starting-in-2021["Cloud TieringライセンスとFabricPoolライセンスの違いについて詳しくは、こちらをご覧ください。"] 。



== クラウド階層化の仕組み

Cloud Tiering は、 FabricPoolテクノロジーを使用して、オンプレミスのONTAPクラスターからパブリック クラウドまたはプライベート クラウドのオブジェクト ストレージに非アクティブな (コールド) データを自動的に階層化するNetApp管理サービスです。  ONTAPへの接続は、コンソール エージェントから行われます。

次の図は、各コンポーネント間の関係を示しています。

image:diagram_cloud_tiering.png["クラウド プロバイダーのコンソール エージェントに接続された Cloud Tiering サービス、 ONTAPクラスターに接続されたエージェント、およびクラウド プロバイダーのONTAPクラスターとオブジェクト ストレージ間の接続を示すアーキテクチャ イメージ。アクティブ データはONTAPクラスターに保存され、非アクティブ データはオブジェクト ストレージに保存されます。"]

大まかに言うと、クラウド階層化は次のように機能します。

. NetAppコンソールからオンプレミス クラスターを検出します。
. 階層化を設定するには、バケット/コンテナ、ストレージ クラスまたはアクセス層、階層化データのライフサイクル ルールなど、オブジェクト ストレージに関する詳細情報を指定します。
. コンソールは、オブジェクト ストレージ プロバイダーを使用するようにONTAPを構成し、クラスター上のアクティブ データと非アクティブ データの量を検出します。
. 階層化するボリュームと、それらのボリュームに適用する階層化ポリシーを選択します。
. ONTAPは、データが非アクティブとみなされるしきい値に達するとすぐに、非アクティブなデータをオブジェクトストアに階層化し始めます（<<ボリューム階層化ポリシー>> ）。
. 階層化データにライフサイクル ルールを適用した場合 (一部のプロバイダーのみで利用可能)、一定の日数が経過すると、古い階層化データはよりコスト効率の高い階層に割り当てられます。




=== ボリューム階層化ポリシー

階層化するボリュームを選択するときは、各ボリュームに適用するボリューム階層化ポリシーを選択します。階層化ポリシーは、ボリュームのユーザー データ ブロックをクラウドに移動するかどうかや、いつ移動するかを決定します。

*冷却期間*を調整することもできます。これは、ボリューム内のユーザー データが「コールド」であるとみなされてオブジェクト ストレージに移動されるまでに非アクティブのままでいなければならない日数です。冷却期間を調整できる階層化ポリシーの場合、有効な値は次のとおりです。

* ONTAP 9.8以降を使用している場合は2～183日
* 以前のONTAPバージョンでは 2 ～ 63 日


2 ～ 63 が推奨されるベスト プラクティスです。

ポリシーなし（なし）:: ボリューム上のデータをパフォーマンス層に保持し、クラウド層に移動されないようにします。
コールド スナップショット (スナップショットのみ):: ONTAP は、アクティブ ファイル システムと共有されていないボリューム内のコールド スナップショット ブロックをオブジェクト ストレージに階層化します。読み取られると、クラウド階層のコールド データ ブロックはホットになり、パフォーマンス階層に移動します。
+
--
データは、集約容量が 50% に達し、データが冷却期間に達した場合にのみ階層化されます。デフォルトの冷却日数は 2 ですが、この数は調整できます。


NOTE: 再加熱されたデータは、スペースがある場合にのみパフォーマンス層に書き戻されます。パフォーマンス層の容量が 70% 以上使用されている場合、ブロックはクラウド層から引き続きアクセスされます。

--
コールドユーザーデータとスナップショット（自動）:: ONTAP は、ボリューム内のすべてのコールド ブロック (メタデータは含まない) をオブジェクト ストレージに階層化します。コールド データには、スナップショット コピーだけでなく、アクティブ ファイル システムからのコールド ユーザー データも含まれます。
+
--
* ランダム リードで読み取られた場合、クラウド階層のコールド データ ブロックはホットになり、パフォーマンス階層に移動されます。
* インデックスやウイルス対策スキャンなどに関連する順次読み取りによって読み取られた場合、クラウド層のコールド データ ブロックはコールドのままとなり、パフォーマンス層には書き込まれません。
+
このポリシーは、 ONTAP 9.4 以降で使用できます。

+
データは、集約容量が 50% に達し、データが冷却期間に達した場合にのみ階層化されます。デフォルトの冷却期間日数は 31 日ですが、この数は調整できます。

+

NOTE: 再加熱されたデータは、スペースがある場合にのみパフォーマンス層に書き戻されます。パフォーマンス層の容量が 70% 以上使用されている場合、ブロックはクラウド層から引き続きアクセスされます。



--
すべてのユーザーデータ（すべて）:: すべてのデータ (メタデータを除く) は直ちにコールドとしてマークされ、できるだけ早くオブジェクト ストレージに階層化されます。ボリューム内の新しいブロックがコールドになるまで 48 時間待つ必要はありません。「すべて」のポリシーが設定される前のボリュームにあるブロックは、コールドになるまで48時間かかります。
+
--
読み込まれた場合、クラウド階層のコールド データ ブロックはコールドのままで、パフォーマンス階層に書き戻されません。このポリシーは、 ONTAP 9.6 以降で使用できます。

この階層化ポリシーを選択する前に、次の点を考慮してください。

* データを階層化すると、ストレージ効率が直ちに低下します (インラインのみ)。
* ボリューム上のコールド データが変更されないことが確実な場合にのみ、このポリシーを使用してください。
* オブジェクト ストレージはトランザクション型ではないため、変更されると大幅な断片化が発生します。
* データ保護関係のソース ボリュームにすべての階層化ポリシーを割り当てる前に、 SnapMirror転送の影響を考慮してください。
+
データはすぐに階層化されるため、 SnapMirror はパフォーマンス層ではなくクラウド層からデータを読み取ります。これにより、 SnapMirror操作が遅くなり、異なる階層化ポリシーを使用している場合でも、キュー内の後の他のSnapMirror操作が遅くなる可能性があります。

* NetApp Backup and Recovery も、階層化ポリシーが設定されたボリュームによって同様に影響を受けます。 https://docs.netapp.com/us-en/bluexp-backup-recovery/concept-ontap-backup-to-cloud.html#fabricpool-tiering-policy-considerations["バックアップとリカバリの階層化ポリシーの考慮事項を参照してください"^] 。


--
すべての DP ユーザーデータ (バックアップ):: データ保護ボリューム上のすべてのデータ (メタデータは除く) は、すぐにクラウド層に移動されます。読み取られた場合、クラウド層のコールド データ ブロックはコールドのままとなり、パフォーマンス層に書き戻されません ( ONTAP 9.4 以降)。
+
--

NOTE: このポリシーは、 ONTAP 9.5 以前で使用できます。  ONTAP 9.6 以降では、*All* 階層化ポリシーに置き換えられました。

--

