---
sidebar: sidebar 
permalink: task-managing-tiering.html 
keywords: discover, volumes, report, hot, cold, inactive, active, capacity, used capacity, savings, health, failed, console 
summary: オンプレミスのONTAPクラスターからのデータ階層化を設定したので、追加のボリュームからデータを階層化したり、ボリュームの階層化ポリシーを変更したり、追加のクラスターを検出したりできるようになります。 
---
= NetApp Cloud Tieringでクラスタのデータ階層化を管理する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
オンプレミスのONTAPクラスターからのデータ階層化を設定したので、 NetApp Cloud Tieringを使用して、追加のボリュームからデータを階層化したり、ボリュームの階層化ポリシーを変更したり、追加のクラスターを検出したりできるようになります。



== クラスターの階層化情報を確認する

クラウド層、ディスク上のデータ、またはクラスターのディスク上のホット データとコールド データの量を確認します。または、クラスターのディスク上のホット データとコールド データの量を確認したい場合もあります。  Cloud Tiering は、各クラスターに対してこの情報を提供します。

.手順
. 左側のナビゲーション メニューから、*モビリティ > クラウド階層化* を選択します。
. *クラスター*ページからメニューアイコンを選択しますimage:icon-action.png["アクションアイコン"]クラスターを選択し、[*クラスター情報*] を選択します。
+
image:screenshot_tiering_cluster_info_button.png["クラスター ページからクラスター情報ボタンを選択したときのスクリーンショット。"]

. クラスターの詳細を確認します。
+
次に例を示します。

+
image:screenshot_tiering_cluster_info.png["クラスターの合計使用データ容量、クラスターの使用容量、およびクラスター情報を示すスクリーンショット。"]



Cloud Volumes ONTAPシステムの場合、表示が異なることに注意してください。  Cloud Volumes ONTAPボリュームではデータをクラウドに階層化できますが、Cloud Tiering サービスは使用されません。 https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-tiering.html["Cloud Volumes ONTAPシステムから低コストのオブジェクト ストレージに非アクティブなデータを階層化する方法を学びます"^] 。

また、 https://docs.netapp.com/us-en/active-iq/task-informed-decisions-based-on-cloud-recommendations.html#tiering["Active IQ Digital Advisor （ Digital Advisorとも呼ばれる）からクラスターの階層化情報を表示する"^]このNetApp製品に精通している場合。左側のナビゲーション ペインから *クラウド推奨事項* を選択します。

image:screenshot_tiering_aiq_fabricpool_info.png["Digital AdvisorのFabricPool Advisor を使用してクラスターのFabricPool情報を表示するスクリーンショット。"]



== 追加ボリュームからの階層データ

新しいボリュームを作成した後など、いつでも追加のボリュームのデータ階層化を設定できます。


TIP: オブジェクト ストレージは、クラスターの階層化を最初にセットアップしたときに既に構成されているため、構成する必要はありません。  ONTAPは、追加のボリュームの非アクティブなデータを同じオブジェクト ストアに階層化します。

.手順
. 左側のナビゲーション メニューから、*モビリティ > クラウド階層化* を選択します。
. *クラスター* ページから、クラスターの *階層ボリューム* を選択します。
+
image:screenshot_tiering_tier_volumes_button.png["クラスターの Tier Volumes ボタンを選択する方法を示したスクリーンショット。"]

. [_Tier Volumes_] ページで、階層化を構成するボリュームを選択し、[Tiering Policy] ページを起動します。
+
** すべてのボリュームを選択するには、タイトル行のボックスをチェックします（image:button_backup_all_volumes.png[""] ）をクリックし、「ボリュームの構成」を選択します。
** 複数のボリュームを選択するには、各ボリュームのボックスをチェックします（image:button_backup_1_volume.png[""] ）をクリックし、「ボリュームの構成」を選択します。
** 単一のボリュームを選択するには、行（またはimage:screenshot_edit_icon.gif["鉛筆アイコンを編集"]ボリュームの（アイコン）をクリックします。
+
image:screenshot_tiering_tier_volumes.png["単一のボリューム、複数のボリューム、またはすべてのボリュームを選択する方法と、選択したボリュームを変更するボタンを示すスクリーンショット。"]



. [_階層化ポリシー_] ダイアログで、階層化ポリシーを選択し、必要に応じて選択したボリュームの冷却日数を調整して、[適用] を選択します。
. [_階層化ポリシー_] ダイアログで、階層化ポリシーを選択し、必要に応じて選択したボリュームの冷却日数を調整して、[適用] を選択します。
+
link:concept-cloud-tiering.html#volume-tiering-policies["ボリューム階層化ポリシーと冷却日の詳細"]。

+
image:screenshot_tiering_policy_settings.png["構成可能な階層化ポリシー設定を示すスクリーンショット。"]



.結果
ONTAP は、選択したボリュームのデータをクラウドに階層化します。



== ボリュームの階層化ポリシーを変更する

ボリュームの階層化ポリシーを変更すると、 ONTAP がコールド データをオブジェクト ストレージに階層化する方法が変更されます。変化はポリシーを変更した瞬間から始まります。ボリュームのその後の階層化動作のみが変更され、データがクラウド層に遡及的に移動されることはありません。

.手順
. 左側のナビゲーション メニューから、*Mobility > CloudTiering* を選択します。
. *クラスター* ページから、クラスターの *階層ボリューム* を選択します。
. *クラスター* ページから、クラスターの *階層ボリューム* を選択します。
. ボリュームの行をクリックし、階層化ポリシーを選択し、必要に応じて冷却日数を調整して、[適用] を選択します。
. ボリュームの行をクリックし、階層化ポリシーを選択し、必要に応じて冷却日数を調整して、[適用] を選択します。
+
link:concept-cloud-tiering.html#volume-tiering-policies["ボリューム階層化ポリシーと冷却日の詳細"]。

+
image:screenshot_tiering_policy_settings.png["構成可能な階層化ポリシー設定を示すスクリーンショット。"]




NOTE: 「階層化データを取得」オプションが表示された場合は、<<クラウド層からパフォーマンス層にデータを移行する,クラウド層からパフォーマンス層にデータを移行する>>詳細については。

.結果
ONTAP は階層化ポリシーを変更し、新しいポリシーに基づいてデータの階層化を開始します。



== 非アクティブなデータをオブジェクトストレージにアップロードするために利用できるネットワーク帯域幅を変更する

クラスターに対して Cloud Tiering をアクティブ化すると、デフォルトでは、 ONTAP は無制限の帯域幅を使用して、システム内のボリュームからオブジェクト ストレージに非アクティブなデータを転送できます。階層化トラフィックがユーザーのワークロードに影響する場合は、転送中に使用されるネットワーク帯域幅を制限します。最大転送速度として 1 ～ 10,000 Mbps の値を選択できます。

. 左側のナビゲーション メニューから、*モビリティ > 階層化* を選択します。
. *クラスター*ページからメニューアイコンを選択しますimage:icon-action.png["アクションアイコン"]クラスターの場合は、[最大転送速度] を選択します。
. *クラスター*ページからメニューアイコンを選択しますimage:icon-action.png["アクションアイコン"]クラスターの場合は、[最大転送速度] を選択します。
+
image:screenshot_tiering_transfer_rate_button.png["クラスター ページから最大転送速度ボタンを選択するスクリーンショット。"]

. [最大転送速度] ページで、[*制限*] ラジオ ボタンを選択し、使用できる最大帯域幅を入力するか、[*無制限*] を選択して制限がないことを示します。次に、[*適用*]を選択します。
. [最大転送速度] ページで、[*制限*] ラジオ ボタンを選択し、使用できる最大帯域幅を入力するか、[*無制限*] を選択して制限がないことを示します。次に、[*適用*]を選択します。
+
image:screenshot_tiering_transfer_rate.png["クラスターの最大転送速度ダイアログのスクリーンショット。"]



この設定は、データを階層化している他のクラスターに割り当てられている帯域幅には影響しません。



== ボリュームの階層化レポートをダウンロードする

階層ボリューム ページのレポートをダウンロードして、管理しているクラスター上のすべてのボリュームの階層化ステータスを確認します。選択するだけですimage:button_download.png["ダウンロード"]ボタン。  Cloud Tiering では、必要に応じて確認したり他のグループに送信したりできる .CSV ファイルが生成されます。  .CSV ファイルには最大 10,000 行のデータが含まれます。

image:screenshot_tiering_report_download.png["すべてのボリュームの階層化ステータスをリストする CSV ファイルを生成する方法を示すスクリーンショット。"]



== クラウド層からパフォーマンス層にデータを移行する

クラウドからアクセスされる階層化データは、「再加熱」されてパフォーマンス層に戻される場合があります。ただし、データをクラウド層からパフォーマンス層にプロアクティブに昇格させたい場合は、[階層化ポリシー] ダイアログでこれを行うことができます。この機能は、 ONTAP 9.8 以降を使用している場合に利用できます。

ボリューム上で階層化の使用を停止する場合、またはすべてのユーザー データをパフォーマンス層に保持し、スナップショット コピーをクラウド層に保持することにした場合、これを実行できます。

次の 2 つのオプションがあります。

[cols="22,45,35"]
|===
| オプション | 説明 | 階層化ポリシーへの影響 


| すべてのデータを復元する | クラウドに階層化されたすべてのボリューム データとスナップショット コピーを取得し、パフォーマンス ティアに昇格します。 | 階層化ポリシーが「ポリシーなし」に変更されます。 


| アクティブなファイルシステムを復元する | クラウドに階層化されたアクティブなファイル システム データのみを取得し、パフォーマンス層に昇格します (スナップショット コピーはクラウドに残ります)。 | 階層化ポリシーが「コールド スナップショット」に変更されます。 
|===

NOTE: クラウドから転送されたデータの量に基づいて、クラウド プロバイダーから料金が請求される場合があります。

.手順
パフォーマンス層に、クラウドから戻されるデータのための十分なスペースがあることを確認します。

. 左側のナビゲーション メニューから、*モビリティ > クラウド階層化* を選択します。
. *クラスター* ページから、クラスターの *階層ボリューム* を選択します。
. *クラスター* ページから、クラスターの *階層ボリューム* を選択します。
. クリックimage:screenshot_edit_icon.gif["ボリュームの階層化テーブルの各行の末尾に表示される編集アイコン"]ボリュームのアイコンをクリックし、使用する取得オプションを選択して、[適用] を選択します。
. クリックimage:screenshot_edit_icon.gif["ボリュームの階層化テーブルの各行の末尾に表示される編集アイコン"]ボリュームのアイコンをクリックし、使用する取得オプションを選択して、[適用] を選択します。
+
image:screenshot_tiering_policy_settings_with_retrieve.png["構成可能な階層化ポリシー設定を示すスクリーンショット。"]



.結果
階層化ポリシーが変更され、階層化されたデータがパフォーマンス層に移行され始めます。クラウド内のデータの量によっては、転送プロセスに時間がかかる場合があります。



== アグリゲートの階層設定を管理する

オンプレミスのONTAPシステムの各アグリゲートには、調整可能な 2 つの設定（階層化の完全性しきい値と、非アクティブ データのレポートを有効にするかどうか）があります。オンプレミスのONTAPシステムの各アグリゲートには、調整可能な 2 つの設定（階層化の完全性しきい値と、非アクティブ データのレポートを有効にするかどうか）があります。

階層化満杯しきい値:: しきい値を低い値に設定すると、階層化が行われる前にパフォーマンス階層に格納する必要があるデータの量が減ります。これは、アクティブなデータがほとんど含まれない大規模な集計の場合に役立つ可能性があります。
+
--
しきい値をより高い数値に設定すると、階層化が行われる前にパフォーマンス階層に格納する必要があるデータの量が増加します。これは、アグリゲートが最大容量に近い場合にのみ階層化するように設計されたソリューションに役立つ可能性があります。

--
Inactive Data Reporting:: 非アクティブ データ レポート (IDR) では、31 日間の冷却期間を使用して、非アクティブと見なされるデータを決定します。階層化されるコールド データの量は、ボリュームに設定された階層化ポリシーによって異なります。この量は、31 日間の冷却期間を使用して IDR によって検出されたコールド データの量とは異なる場合があります。
+
--

TIP: IDR は非アクティブなデータと節約の機会を特定するのに役立つため、有効にしておくことをお勧めします。アグリゲート上でデータ階層化が有効になっている場合は、IDR を有効のままにしておく必要があります。

--


.手順
. *クラスター* ページから、選択したクラスターの *詳細設定* を選択します。
. *クラスター* ページから、選択したクラスターの *詳細設定* を選択します。
+
image:screenshot_tiering_advanced_setup_button.png["クラスターの「詳細設定」ボタンを示すスクリーンショット。"]

. 「詳細設定」ページで、アグリゲートのメニュー アイコンを選択し、「アグリゲートの変更」を選択します。
. 「詳細設定」ページで、アグリゲートのメニュー アイコンを選択し、「アグリゲートの変更」を選択します。
+
image:screenshot_tiering_modify_aggr.png["集計の「集計の変更」オプションを示すスクリーンショット。"]

. 表示されるダイアログで、完全性のしきい値を変更し、非アクティブなデータのレポートを有効にするか無効にするかを選択します。
+
image:screenshot_tiering_modify_aggregate.png["階層化の完全性のしきい値を変更するスライダーと、非アクティブなデータのレポートを有効または無効にするボタンを示すスクリーンショット。"]

. *適用*をクリックします。




== 運用の健全性を改善する

障害が発生した場合、クラウド階層化により、クラスター ダッシュボードに「失敗」の動作正常性ステータスが表示されます。ヘルスは、 ONTAPシステムとNetApp Consoleのステータスを反映します。

.手順
. 運用状態が「失敗」となっているクラスターを特定します。
. 情報「i」アイコンにマウスを合わせると、失敗の理由が表示されます。
. 問題を修正します:
+
.. ONTAPクラスタが動作していること、およびオブジェクト ストレージ プロバイダへのインバウンド接続とアウトバウンド接続があることを確認します。
.. コンソールに、クラウド階層化サービス、オブジェクト ストア、および検出されたONTAPクラスターへの送信接続があることを確認します。






== クラウド階層化から追加のクラスターを検出する

検出されていないオンプレミスのONTAPクラスターを Tiering _Cluster_ ページからコンソールに追加して、クラスターの階層化を有効にすることができます。

追加のクラスターを検出するためのボタンが Tiering _On-Prem ダッシュボード_ ページにも表示されることに注意してください。

.手順
. クラウド階層化から、[クラスター] タブを選択します。
. 未検出のクラスターを表示するには、[*未検出のクラスターを表示*] を選択します。
. 未検出のクラスターを表示するには、[*未検出のクラスターを表示*] を選択します。
+
image:screenshot_tiering_show_undiscovered_cluster.png["階層化ダッシュボードの「未検出クラスターの表示」ボタンを示すスクリーンショット。"]

+
NSS 認証情報がコンソールに保存されている場合は、アカウント内のクラスターがリストに表示されます。

+
NSS 認証情報が保存されていない場合は、未検出のクラスターを表示する前に、まず認証情報を追加するように求められます。

+
image:screenshot_tiering_discover_cluster.png["既存のクラスターを検出してコンソールと階層化ダッシュボードに追加する方法を示すスクリーンショット。"]

. コンソールを通じて管理し、データ階層化を実装するクラスターの *クラスターの検出* をクリックします。
. _クラスターの詳細_ページで、管理者ユーザー アカウントのパスワードを入力し、*検出*を選択します。
. _クラスターの詳細_ページで、管理者ユーザー アカウントのパスワードを入力し、*検出*を選択します。
+
クラスター管理 IP アドレスは、NSS アカウントの情報に基づいて入力されることに注意してください。

. _詳細と資格情報_ ページでクラスター名がシステム名として追加されるので、[実行] を選択します。


.結果
コンソールはクラスターを検出し、クラスター名をシステム名として使用してそれをシステム ページに追加します。

右側のパネルで、このクラスターの階層化サービスまたはその他のサービスを有効にすることができます。



== すべてのコンソールエージェントにわたってクラスターを検索する

複数のエージェントを使用して環境内のすべてのストレージを管理している場合、階層化を実装する一部のクラスターが別のエージェントにある可能性があります。特定のクラスターを管理しているエージェントがわからない場合は、Cloud Tiering を使用してすべてのエージェントを検索できます。

.手順
. クラウド階層化メニュー バーで、アクション メニューを選択し、*すべてのエージェントでクラスターを検索* を選択します。
+
image:screenshot_tiering_search for_cluster.png["いずれかのエージェントに存在する可能性のあるクラスターを検索する方法を示したスクリーンショット。"]

. 表示された検索ダイアログで、クラスターの名前を入力し、「検索」を選択します。
+
Cloud Tiering では、クラスターが見つかった場合、エージェントの名前が表示されます。

. https://docs.netapp.com/us-en/bluexp-setup-admin/task-manage-multiple-connectors.html#switch-between-connectors["エージェントに切り替えてクラスタの階層化を構成する"^]。

